# Engineering Toolbox Formula Parser

Парсер для извлечения инженерных формул с сайта [EngineeringToolbox.com](https://www.engineeringtoolbox.com).

Этот инструмент позволяет собрать формулы со всего сайта, извлечь из них переменные и их описания, определить категории и сохранить всё в структурированный JSON-файл для удобного дальнейшего использования. Цель проекта — создать базу данных инженерных формул для разработки приложений, обучения или систематизации знаний.

## Возможности

- Полный систематический обход сайта (BFS)
- Извлечение формул из текста, HTML-элементов и изображений (OCR)
- Определение переменных, их описаний и единиц измерения
- Категоризация формул по разделам сайта
- Сохранение в структурированном JSON формате
- Обработка ошибок и восстановление сессии
- Многопоточная обработка для быстрой работы

## Установка и настройка

### Требования:
- Python 3.7 или выше
- Доступ к интернету
- 50+ МБ свободного места для хранения результатов (зависит от количества обработанных страниц)

### Основные зависимости:
- `requests`: для HTTP-запросов
- `beautifulsoup4`: для парсинга HTML
- `pytesseract` и `Pillow`: для распознавания формул из изображений (опционально)

### Пошаговая установка:

1. **Клонирование репозитория**
   ```bash
   git clone <https://github.com/MakazhanAlpamys/parser>
   cd parser
   ```

2. **Создание виртуального окружения (рекомендуется)**
   ```bash
   # Windows
   python -m venv venv
   venv\Scripts\activate
   
   # Linux/macOS
   python3 -m venv venv
   source venv/bin/activate
   ```

3. **Установка базовых зависимостей**
   ```bash
   pip install requests beautifulsoup4
   ```

4. **Установка OCR-компонентов (опционально, но рекомендуется)**
   ```bash
   pip install pillow pytesseract
   ```
   
   Также требуется установка Tesseract OCR:
   - **Windows**: Скачайте установщик с [github.com/UB-Mannheim/tesseract/wiki](https://github.com/UB-Mannheim/tesseract/wiki)
   - **Ubuntu/Debian**: `sudo apt install tesseract-ocr`
   - **macOS**: `brew install tesseract`

5. **Проверка установки**
   ```bash
   python -c "import requests, bs4, PIL; print('Все базовые зависимости установлены!')"
   ```

> **Примечание**: Без модуля OCR парсер все равно будет работать, но не сможет извлекать формулы из изображений.

## Использование

Парсер можно запускать с разными параметрами в зависимости от ваших потребностей.

### Базовый запуск
Самый простой способ запуска парсера со всеми настройками по умолчанию:

```bash
python parser.py
```
Этот вариант использует 2 потока, обрабатывает до 1500 страниц и сохраняет результаты в файл "engineering_formulas_complete.json".

### Запуск с настройками
Для более гибкого управления процессом парсинга:

```bash
python parser.py --max-pages 500 --threads 4 --output formulas.json
```
В этом примере мы:
- Ограничиваем обработку до 500 страниц (быстрее завершится)
- Используем 4 потока для параллельной обработки (увеличивает скорость)
- Сохраняем результат в файл "formulas.json"

### Продолжение прерванной сессии
Если парсинг был прерван, вы можете продолжить с места остановки:

```bash
python parser.py --resume --output previous_formulas.json
```
Эта команда загрузит данные из указанного JSON-файла и продолжит обход сайта с уже посещенных страниц.

### Отладочный режим
Для получения подробных логов и диагностики проблем:

```bash
python parser.py --debug --max-pages 100
```

## Аргументы командной строки

Все доступные параметры можно посмотреть с помощью:
```bash
python parser.py --help
```

### Основные параметры:

| Аргумент | Описание | По умолчанию |
|----------|----------|--------------|
| `--start-url` | URL, с которого начинается обход | https://www.engineeringtoolbox.com |
| `--max-pages` | Максимальное количество страниц для обхода | 1500 |
| `--output` | Имя файла для сохранения результатов | engineering_formulas_complete.json |
| `--threads` | Количество параллельных потоков | 2 |

### Дополнительные опции:

| Аргумент | Описание | По умолчанию |
|----------|----------|--------------|
| `--resume` | Продолжить с места остановки предыдущей сессии | False |
| `--log-level` | Уровень детализации логов (DEBUG/INFO/WARNING/ERROR) | INFO |
| `--debug` | Включить подробное логирование | False |
| `--examples` | Количество примеров в итоговом отчете | 5 |

Количество потоков (`--threads`) стоит выбирать в зависимости от мощности компьютера и скорости интернет-соединения. Больше потоков может ускорить процесс, но также увеличит нагрузку на сайт и на вашу систему.

## Формат вывода

```json
[
  {
    "category": "Mechanics",
    "subcategory": "Acceleration and Velocity",
    "formula_name": "Final Velocity",
    "formula": "v1 = v0 + a * t",
    "description": "Calculates the final velocity of an object.",
    "variables": [
      {
        "symbol": "v1",
        "description": "Final velocity",
        "unit": "m/s"
      },
      {
        "symbol": "v0",
        "description": "Initial velocity",
        "unit": "m/s"
      },
      {
        "symbol": "a",
        "description": "Acceleration",
        "unit": "m/s^2"
      },
      {
        "symbol": "t",
        "description": "Time taken",
        "unit": "s"
      }
    ],
    "url": "https://www.engineeringtoolbox.com/acceleration-velocity-d_1769.html"
  }
]
```

## Особенности реализации

### Технические решения:
1. **Обход сайта**: Реализован BFS-алгоритм с очередью URL, который систематически обходит весь сайт, начиная с главной страницы
2. **Извлечение формул**: Применяется многоуровневый подход:
   - Регулярные выражения для текстового контента
   - Анализ DOM для специальных элементов формул (MathML и др.)
   - Поиск в таблицах и списках
   - OCR для изображений с формулами
3. **Обработка переменных**: Интеллектуальное извлечение:
   - Распознавание переменных из формул
   - Сопоставление с описаниями в тексте
   - Поддержка инженерных обозначений (Re, Nu, Pr и т.д.)
   - Определение единиц измерения

### Оптимизации:
- **Многопоточность**: Параллельная обработка через ThreadPoolExecutor
- **Кэширование**: Отслеживание посещенных URL
- **Ограничение нагрузки**: Интеллектуальные задержки между запросами
- **Устойчивость**: Обработка ошибок с механизмом повторных попыток
- **Прогресс-сохранение**: Периодическое сохранение результатов

### Соблюдение этики:
- **Проверка robots.txt**: Соблюдение правил сайта
- **Ограничение частоты**: Управляемые задержки между запросами
- **Идентификация**: Корректный User-Agent

## Автор

Makazhan Alpamys, 2025

## Лицензия

MIT

## Дополнительная информация

Парсер разработан с учетом требований вежливого веб-скрапинга:
- Соблюдает правила robots.txt
- Использует случайные задержки между запросами
- Корректно идентифицирует себя через User-Agent

Этот инструмент предназначен только для образовательных и исследовательских целей. Авторские права на содержимое сайта engineeringtoolbox.com принадлежат их владельцам.
